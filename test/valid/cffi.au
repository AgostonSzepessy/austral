;; -*- mode: lisp -*-
(defmodule cffi-test
  (:use :austral)
  (:import-from :austral.ext.cffi
                :foreign-funcall
                :foreign-pointer
                :malloc
                :free
                :null-pointer))
(in-module :cffi-test)

(defun main () i32
  ;; Use foreign-funcall
  (let ((pointer (foreign-funcall "malloc" (foreign-pointer i32) 4)))
    (foreign-funcall "free" unit pointer))
  ;; Use built-in methods
  (let ((pointer (the (foreign-pointer i32) (malloc (the u64 4))))
        (null-pointer (null-pointer i32)))
    (free pointer))
  (the i32 0))
